<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ComfyUI Node Station</title>
    <link rel="preload" href="style.css" as="style">
    <link rel="stylesheet" href="style.css">
    <!-- Ícones Material Design -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- SweetAlert2 para alertas bonitos -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="header">
                <h1>NodeStation</h1>
                <div class="header-actions">
                    <div id="connectionStatus" class="status-indicator" title="Status da Conexão"></div>
                    <!-- Botão Novo de Toggle Galeria -->
                    <button id="toggleGalleryBtn" class="icon-btn" title="Ocultar Galeria">
                        <span class="material-icons">visibility</span>
                    </button>
                    <button id="settingsBtn" class="icon-btn" title="Configurações">
                        <span class="material-icons">settings</span>
                    </button>
                </div>
            </div>

            <div class="controls">
                <!-- Controle de LoRAs Múltiplos -->
                <div class="control-group">
                    <div class="slider-header" style="margin-bottom: 6px;">
                        <label>LoRAs</label>
                        <div style="display: flex; gap: 8px;">
                            <button id="addLoraRowBtn" class="icon-btn"
                                style="border-radius: 4px; padding: 4px; background: rgba(255,255,255,0.05);"
                                title="Adicionar LoRA">
                                <span class="material-icons" style="font-size: 1.1rem;">add</span>
                            </button>
                            <button id="manageLorasBtn" class="edit-lora-btn" title="Gerenciar Lista de LoRAs">
                                <span class="material-icons" style="font-size: 1.1rem;">edit</span>
                            </button>
                        </div>
                    </div>
                    <div id="activeLorasContainer" class="active-loras-container">
                        <!-- Linhas de LoRA injetadas via JS -->
                    </div>
                </div>

                <div class="control-group">
                    <label>Prompt Positivo</label>
                    <textarea id="positivePrompt"
                        rows="4">masterpiece, best quality, amazing quality, 1girl, solo, simple background, white background</textarea>
                </div>
                <div class="control-group">
                    <label>Prompt Negativo</label>
                    <textarea id="negativePrompt"
                        rows="3">bad quality, worst quality, worst detail, sketch, censor, bad anatomy, (bad hands:1.3), (multiple views:1.5)</textarea>
                </div>
                <div class="control-group row">
                    <div class="input-wrapper">
                        <label>Largura</label>
                        <input type="number" id="widthInput" value="1024" step="64">
                    </div>
                    <div class="input-wrapper">
                        <label>Altura</label>
                        <input type="number" id="heightInput" value="1384" step="64">
                    </div>
                </div>

                <!-- CONTROLE DE UPSCALE -->
                <div class="control-group">
                    <div class="slider-header">
                        <label>Nível de Upscale</label>
                        <span id="upscaleValueDisplay" class="value-display">1x</span>
                    </div>
                    <input type="range" id="upscaleInput" min="1" max="4" value="1" step="0.5" class="slider">
                    <div class="slider-labels">
                        <small>Rápido (1x)</small>
                        <small>Detalhado (4x)</small>
                    </div>
                </div>

                <!-- CONTROLE DE SEED -->
                <div class="control-group">
                    <label>Seed (Semente)</label>
                    <div class="seed-control">
                        <input type="number" id="seedInput" placeholder="Aleatório" disabled>
                        <label class="checkbox-label" title="Desmarcar para escolher uma seed fixa">
                            <input type="checkbox" id="randomSeedBtn" checked>
                            <span class="checkbox-text">Aleatório</span>
                        </label>
                    </div>
                </div>

                <button id="generateBtn" class="primary-btn">
                    <span class="material-icons">auto_awesome</span> Gerar Imagem
                </button>

                <div class="queue-container">
                    <label>Fila de Processamento</label>
                    <div id="queueList" class="queue-list">
                        <!-- Itens da fila renderizados via JS -->
                    </div>
                </div>
            </div>

            <div class="footer-note">
                <small id="serverAddressDisplay" style="color: var(--text-muted);">Conectado...</small>
            </div>
        </aside>

        <!-- CONTEÚDO PRINCIPAL -->
        <main class="main-content">
            <!-- Área de Visualização (Live View) FIXA -->
            <div class="live-view">
                <!-- Cabeçalho de ações -->
                <div id="imageActions" class="live-view-header hidden">
                    <div class="actions-group">
                        <button id="infoImgBtn" class="action-btn info" title="Ver Metadados (Prompt/Seed)">
                            <span class="material-icons">info</span>
                        </button>
                        <button id="deleteImgBtn" class="action-btn delete" title="Excluir">
                            <span class="material-icons">delete</span>
                        </button>
                        <button id="closeImgBtn" class="action-btn close" title="Fechar Visualização">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                </div>

                <!-- Área de conteúdo onde a imagem e o placeholder ficam -->
                <div class="live-view-content">
                    <div id="placeholder" class="placeholder">
                        <span class="material-icons">image</span>
                        <p>Aguardando geração...</p>
                    </div>
                    <img id="resultImage" class="hidden" alt="Resultado" decoding="async">
                </div>

                <!-- Overlay de Progresso (Fixo no fundo da live-view) -->
                <div id="progressOverlay" class="progress-overlay hidden">
                    <div class="spinner"></div>
                    <div class="progress-bar-container">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>
                    <p id="progressText" style="color: white; margin-left: 10px; font-size: 0.8rem;">0%</p>
                </div>
            </div>

            <!-- Galeria ROLÁVEL -->
            <div class="gallery-section">
                <div class="gallery-header">
                    <div class="gallery-search-wrapper">
                        <h2 class="desktop-only">Galeria</h2>
                        <div class="search-box">
                            <span class="material-icons search-icon">search</span>
                            <input type="text" id="searchInput" placeholder="Pesquisar tags (ex: cat, blue_sky)...">
                        </div>
                    </div>

                    <div class="gallery-tools">
                        <button id="toggleSelectModeBtn" class="text-btn">
                            <span class="material-icons"
                                style="font-size: 1.1rem; vertical-align: middle;">check_box</span>
                            <span class="btn-label">Selecionar</span>
                        </button>
                        <button id="deleteBatchBtn" class="text-btn delete-batch hidden">
                            <span class="material-icons"
                                style="font-size: 1.1rem; vertical-align: middle;">delete</span>
                            <span class="btn-label">Excluir (<span id="selectedCount">0</span>)</span>
                        </button>
                    </div>
                </div>
                <div id="galleryGrid" class="gallery-grid"></div>
            </div>
        </main>
    </div>

    <!-- MODAL DE CONFIGURAÇÕES DE LORA -->
    <div id="loraModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gerenciador de LoRAs</h2>
                <button id="closeLoraModalBtn" class="icon-btn-plain"><span class="material-icons">close</span></button>
            </div>
            <div class="modal-body">
                <div class="control-group">
                    <label>Adicionar Novo LoRA</label>
                    <div class="lora-input-group">
                        <input type="text" id="newLoraInput" placeholder="Ex: anime_style.safetensors">
                        <button id="addLoraBtn" class="primary-btn"
                            style="width: auto; padding: 10px 15px;">Adicionar</button>
                    </div>
                </div>

                <div class="control-group" style="margin-top: 20px;">
                    <label>LoRAs Salvos</label>
                    <div id="loraManagementList" class="lora-list">
                        <!-- Itens renderizados via JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE CONFIGURAÇÕES GERAIS -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configurações do Servidor</h2>
                <button id="closeSettingsBtn" class="icon-btn-plain"><span class="material-icons">close</span></button>
            </div>
            <div class="modal-body">
                <div class="control-group">
                    <label>URL Base do ComfyUI</label>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">Ex: http://127.0.0.1:8188 ou link do
                        Zrok</p>
                    <input type="text" id="comfyUrlInput" placeholder="http://127.0.0.1:8188">
                </div>
            </div>
            <div class="modal-actions">
                <button id="cancelSettingsAction" class="secondary-btn">Cancelar</button>
                <button id="saveSettingsBtn" class="primary-btn">Salvar Conexão</button>
            </div>
        </div>
    </div>

    <script src="script.js" defer></script>
</body>

</html>